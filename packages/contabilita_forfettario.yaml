# ==========================================
# Package: Contabilità Forfettario
# Progetto: ha-contabilita-forfettario
# Versione: 0.1.0
# ==========================================

input_number:

  cf_ricavi_annui:
    name: "Ricavi annui"
    min: 0
    max: 150000
    step: 100
    unit_of_measurement: "€"
    mode: box
    icon: mdi:cash-multiple

  cf_coefficiente_redditivita:
    name: "Coefficiente di redditività"
    min: 0
    max: 1
    step: 0.01
    unit_of_measurement: "%"
    mode: box
    icon: mdi:percent

  cf_aliquota_imposta:
    name: "Aliquota imposta sostitutiva"
    min: 0
    max: 1
    step: 0.01
    unit_of_measurement: "%"
    mode: box
    icon: mdi:scale-balance

  cf_aliquota_inps:
    name: "Aliquota contributi INPS"
    min: 0
    max: 1
    step: 0.01
    unit_of_measurement: "%"
    mode: box
    icon: mdi:account-cash

template:
  - sensor:
      - name: "CF Reddito imponibile"
        unique_id: cf_reddito_imponibile
        icon: mdi:calculator
        unit_of_measurement: "€"
        state: >
          {% set ricavi = states('input_number.cf_ricavi_annui') | float(0) %}
          {% set coeff = states('input_number.cf_coefficiente_redditivita') | float(0) %}
          {{ (ricavi * coeff) | round(2) }}
          
      - name: "CF Imposta sostitutiva"
        unique_id: cf_imposta_sostitutiva
        icon: mdi:cash-check
        unit_of_measurement: "€"
        state: >
          {% set reddito = states('sensor.cf_reddito_imponibile') | float(0) %}
          {% set aliquota = states('input_number.cf_aliquota_imposta') | float(0) %}
          {% set imposta = reddito * aliquota %}
          {% if imposta < 257 %}
            0
          {% else %}
            {{ imposta | round(2) }}
          {% endif %}
          
      - name: "CF Contributi INPS"
        unique_id: cf_contributi_inps
        icon: mdi:account-cash
        unit_of_measurement: "€"
        state: >
          {% set reddito = states('sensor.cf_reddito_imponibile') | float(0) %}
          {% set aliquota = states('input_number.cf_aliquota_inps') | float(0) %}
          {{ (reddito * aliquota) | round(2) }}
          
      - name: "CF Reddito netto stimato"
        unique_id: cf_reddito_netto
        icon: mdi:wallet
        unit_of_measurement: "€"
        state: >
          {% set reddito = states('sensor.cf_reddito_imponibile') | float(0) %}
          {% set imposta = states('sensor.cf_imposta_sostitutiva') | float(0) %}
          {% set inps = states('sensor.cf_contributi_inps') | float(0) %}
          {{ (reddito - imposta - inps) | round(2) }}


